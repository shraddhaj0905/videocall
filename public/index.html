<!DOCTYPE html>
<html>
<head>
  <title>Video Call App</title>
  <style>
    body { text-align: center; font-family: Arial; }
    video { width: 300px; margin: 10px; border: 2px solid black; }
  </style>
</head>
<body>

<h2>Real-Time Video Call</h2>

<input id="roomInput" placeholder="Enter Room ID" />
<button onclick="joinRoom()">Join</button>

<br><br>

<video id="localVideo" autoplay muted playsinline></video>
<video id="remoteVideo" autoplay playsinline></video>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let peerConnection;
let roomId;

const iceServers = {
  iceServers: [
    { urls: "stun:stun.l.google.com:19302" }
  ]
};

async function joinRoom() {
  roomId = document.getElementById("roomInput").value;

  peerConnection = new RTCPeerConnection(iceServers);

  const stream = await navigator.mediaDevices.getUserMedia({
    video: true,
    audio: true
  });

  document.getElementById("localVideo").srcObject = stream;

  stream.getTracks().forEach(track => {
    peerConnection.addTrack(track, stream);
  });

  peerConnection.ontrack = (event) => {
    document.getElementById("remoteVideo").srcObject = event.streams[0];
  };

  peerConnection.onicecandidate = (event) => {
    if (event.candidate) {
      socket.emit("ice-candidate", {
        candidate: event.candidate,
        roomId
      });
    }
  };

  socket.emit("join-room", roomId);
}

socket.on("ready", async () => {
  const offer = await peerConnection.createOffer();
  await peerConnection.setLocalDescription(offer);
  socket.emit("offer", { offer, roomId });
});

socket.on("offer", async (offer) => {
  await peerConnection.setRemoteDescription(offer);
  const answer = await peerConnection.createAnswer();
  await peerConnection.setLocalDescription(answer);
  socket.emit("answer", { answer, roomId });
});

socket.on("answer", async (answer) => {
  await peerConnection.setRemoteDescription(answer);
});

socket.on("ice-candidate", async (candidate) => {
  if (candidate) {
    await peerConnection.addIceCandidate(candidate);
  }
});
</script>

</body>
</html>